define(["underscore","jquery","backbone","Date","../../services/request.service","../../services/event.service"],function(e,t,a,n,o,r){var i={};return i._awardHTMLCallback,i._awardTimerCallback,i._issuenoDataCallback,i._updatePlanCallback,i.initialize=function(e,a,n){this.lotteryCode=e,this.lotteryType=a,this.needUpdatePlan=n;var o=this;r.on("countDowning_timerContainer",function(e){var a=e.toString().SecondsToddhhmmss().split(":"),n="";n=parseInt(a[0])>0?"<b>"+a[0]+"</b><i>天</i><b>"+a[1]+"</b><i>时</i>":parseInt(a[1])>0?"<b>"+a[1]+"</b><i>时</i><b>"+a[2]+"</b><i>分</i>":"<b>"+a[2]+"</b><i>分</i><b>"+a[3]+"</b><i>秒</i>",t(".timeBlock .time").html(n)}),r.on("getAwardTimeObject_timerContainer",function(e){if(o.nextPeriod=e.nextPeriod,t(".next-period").html(o.nextPeriod+"期"),e.originTime){var a=new Date(e.originTime.replace(/-/g,"/")).format("MM-dd hh:mm");t("#lotteryTimerTime").html(a)}}),r.on("complete_timerContainer",function(){t(".beProgressing").show(),t(".preterite").hide(),t(".current-period").html(o.nextPeriod)}),r.on("lotteryResults_timerComponent",function(e){t(".beProgressing").hide(),t(".preterite").show(),i.getAwardHTML(function(e){r.emit("awardHTML_lotteryAction",e),i.needUpdatePlan&&setTimeout(function(){i.updatePlan(function(e){r.emit("awardPlanHTML_lotteryAction",e)})},3e4+Math.random())})}),r.on("digitQuery_historyContainer",function(e){i.getAwardHTML(function(e){r.emit("awardDigitHTML_lotteryAction",e)},e.year,e.day)}),r.on("digitExport_historyContainer",function(e){window.open("/api/"+o.lotteryType+"/"+o.lotteryCode+"/export/"+e.type+"/"+e.year)}),r.on("asyncSuccess_awardHTML",function(e){o._awardHTMLCallback(e)}),r.on("asyncSuccess_awardTimer",function(e){o._awardTimerCallback(e)}),r.on("asyncSuccess_issuenoData",function(e){o._issuenoDataCallback(e)}),r.on("asyncSuccess_updatePlan",function(e){o._updatePlanCallback(e)})},i.getAwardHTML=function(e,t,a){if("function"!=typeof e)console.error("getAwardHTML：请求数据的参数不正确，_callBack不是函数类型");else{var n={date:t,t:Math.random()};a&&(n.year=t,n.day=a),i._awardHTMLCallback=e,o.requestGet("/"+this.lotteryType+"/"+this.lotteryCode+"/indexPage",n,"asyncSuccess_awardHTML")}},i.updatePlan=function(e){if("function"!=typeof e)console.error("getAwardHTML：请求数据的参数不正确，_callBack不是函数类型");else{var t={lotteryCode:this.lotteryCode,t:Math.random()};i._updatePlanCallback=e,o.requestGet("/plan/updatePlan",t,"asyncSuccess_updatePlan")}},i.getAwardResult=function(e){if("function"!=typeof e)console.error("getAwardResult：请求数据的参数不正确，_callBack不是函数类型");else{var t={t:Math.random()};i._awardTimerCallback=e,o.requestGet("/lottery/"+this.lotteryCode+"/getawarddata",t,"asyncSuccess_awardTimer")}},i.getIssuenoData=function(e,t){if(void 0==e||"number"!=typeof e)return void console.error("getIssuenoData：请求数据的参数不正确，_issueno不是数字类型");if("function"!=typeof t)return void console.error("getIssuenoData：请求数据的_callBack参数不正确，_callBack不是函数类型");var a={t:Math.random(),issueno:e};i._issuenoDataCallback=t,o.requestGet("/"+this.lotteryType+"/"+this.lotteryCode+"/getawardinfobyissueno",a,"asyncSuccess_issuenoData")},i.loopResult=function(e){var t=this,a=setInterval(function(){t.getAwardResult(function(n){n.period==e&&(window.clearInterval(a),t.getAwardHTML(function(e){r.emit("awardHTML_lotteryAction",e)}))})},3e3+1e3*parseInt(Math.floor(5*Math.random()+1)))},i});