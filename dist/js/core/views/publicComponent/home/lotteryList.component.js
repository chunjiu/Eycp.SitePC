define(["underscore","jquery","String","Date","backbone","../../../services/event.service"],function(t,e,n,i,a,r){return a.View.extend({el:"#lotteryList",tab:"#tab",content:"#content",lis:"#content .lis",lnLi:"#content .lis .ln-li",lnli:".ln-li",events:{"mouseenter #tab a":"handleMouseEnterTab"},initialize:function(){var t=this;t.tempArray=[],t.tabCodeString="",t.tabCodeArray=[],e(t.lis).each(function(n,i){"none"!=e(i).css("display")&&e(i).find(t.lnli).each(function(n,i){t.tabCodeArray.push(e(i).attr("data-code"))})}),t.countDown(),r.on("changeLottery_LotteryListComponent",function(e){t.changeLottery(e)}),r.on("checkIsAward_LotteryListComponent",function(e){t.checkIsAward(e)}),r.on("changeTabLotteryListAwardState_LotteryListComponent",function(e){t.changeTabLotteryListAwardTime(e)}),r.on("upDatePeriodAttr_lotteryListComponent",function(e){t.upDatePeriodAttr(e)})},changeTabLotteryListAwardTime:function(t){e(this.lis).each(function(n,i){"none"!=e(i).css("display")&&e(i).html(t.resultHtml)})},upDatePeriodAttr:function(t){var n=this;e(n.content+" .active").find(n.lnli).each(function(n,i){if(t.lotteryCode==e(i).attr("data-code"))return e(i).attr("data-nextperiod",t.next.period),!1})},checkIsAward:function(t){var n=this;e(n.content+" .active").find(n.lnli).each(function(i,a){if(t.lotteryCode==e(a).attr("data-code")&&e(a).attr("data-nextPeriod")==t.result.period){if(e(a).find(".latestIssue i").html(t.result.period),e(a).find(".beProgressing").html("").hide(),e(a).find(".data").html(n.awardDateFormat(t.result.awardTime)),e(a).find(".newInfoBlock").find(".number").remove(),e(a).find(".newInfoBlock").find(".info").after(n.updateAward(t.result.result,t.lotteryCode)),t.clearIntervalArray.length>0)for(var o=0;o<t.clearIntervalArray.length;o++)t.clearIntervalArray[o].lotteryCode==t.lotteryCode&&(window.clearInterval(t.clearIntervalArray[o].clearNum),t.clearIntervalArray.splice(e.inArray(t.clearIntervalArray[o],t.clearIntervalArray),1));return r.emit("upDateNextPeriod_lotteryListComponent",t.lotteryCode),!1}})},updateAward:function(t,e){var n,i,a,r="",o="";if(/\|/.test(t)?(n=t.split("|"),i=n[0].split(","),a=n[1].split(",")):i=t.split(","),"bjpk10"==e||"xyft"==e?r="pk10":/k3/.test(e)&&(r="k3"),"object"==typeof i&&void 0!=i&&i.length>0)for(var d=0;d<i.length;d++)/k3/.test(e)?o+='<span class="num0'+i[d]+'"></span>':"bjpk10"==e||"xyft"==e?parseInt(i[d])<10?o+='<span class="num0'+i[d]+'"></span>':o+='<span class="num'+i[d]+'"></span>':o+='<span class="red">'+i[d]+"</span>";if("object"==typeof a&&void 0!=a&&a.length>0)for(var d=0;d<a.length;d++)o+='<span class="blue">'+a[d]+"</span>";return'<div class="number '+r+'">'+o+"</div>"},awardDateFormat:function(t){return t?(t=t.replace(/-/g,"/"),t=new Date(t),t.format("MM-dd hh:mm")):""},handleMouseEnterTab:function(t){var n=this,i=e(t.currentTarget);if(!i.hasClass("more")){i.parent().find("a").removeClass("active"),i.addClass("active");var a=i.attr("data-classity");n.tabCodeString="",n.tabCodeArray=[],e(n.lis).each(function(t,i){e(i).attr("data-classity")==a?(e(i).show(),e(i).addClass("active"),e(i).find(n.lnli).each(function(t,a){t==e(i).find(n.lnli).length-1?n.tabCodeString+=e(a).attr("data-code"):n.tabCodeString+=e(a).attr("data-code")+",",n.tabCodeArray.push(e(a).attr("data-code"))}),r.emit("getGroupAwards_LotteryListComponent",n.tabCodeString),r.emit("clearIntervalArray_LotteryListComponent")):(e(i).hide(),e(i).removeClass("active"),e(i).find(n.lnli).each(function(t,n){e(n).find(".time").attr("data-time",""),e(n).find(".time").html("<span><b>--</b><i>--</i></span>")}))})}},changeLottery:function(t){var n=this,i=t.lotteryCode;if(void 0==t)return void console.error("changeLottery：返回得数据有问题！");e(n.content+" .active").find(n.lnli).each(function(a,r){if(e(r).attr("data-code")==i)return e(r).find(".time").attr("data-time",t.awardTimeInterval),e(r).find(".beProgressing").html("第"+t.current.period+"期正在开奖.....").fadeIn(600),-1!=e.inArray(i,n.tempArray)&&n.tempArray.splice(e.inArray(i,n.tempArray),1),!1})},countDown:function(){var t=this,n=!1;window.setInterval(function(){e(t.content+" .active").find(t.lnli).each(function(i,a){var o;o=""!=e(a).find(".time").attr("data-time")?parseFloat(e(a).find(".time").attr("data-time")):void 0;var d=e(a).attr("data-code");if(-1!=e.inArray(d,t.tabCodeArray)&&void 0!=o){if(o<=0)e(a).find(".time").attr("data-time",""),e(a).find(".dayDom").html("<b>00</b><i>天</i>"),e(a).find(".hourDom").html("<b>00</b><i>时</i>"),e(a).find(".minuteDom").html("<b>00</b><i>分</i>"),e(a).find(".secondDom").html("<b>00</b><i>秒</i>"),-1==e.inArray(d,t.tempArray)&&(t.tempArray.push(e(a).attr("data-code")),0==n?(r.emit("getAwardTime_lotteryListComponent",d),n=!0,window.setTimeout(function(){n=!1},600)):window.setTimeout(function(){r.emit("getAwardTime_lotteryListComponent",d)},1e3));else if(""!=e(a).find(".time").attr("data-time")){o--,e(a).find(".time").attr("data-time",o);var s=(""+o).SecondsToddhhmmss().split(":");4==s.length&&("00"==s[0]?"00"==s[1]?(e(a).find(".dayDom").hide(),e(a).find(".hourDom").hide(),e(a).find(".minuteDom").show(),e(a).find(".secondDom").show()):(e(a).find(".dayDom").hide(),e(a).find(".hourDom").show(),e(a).find(".minuteDom").show(),e(a).find(".secondDom").hide()):(e(a).find(".dayDom").show(),e(a).find(".hourDom").show(),e(a).find(".minuteDom").hide(),e(a).find(".secondDom").hide())),e(a).find(".dayDom").html("<b>"+s[0]+"</b><i>天</i>"),e(a).find(".hourDom").html("<b>"+s[1]+"</b><i>时</i>"),e(a).find(".minuteDom").html("<b>"+s[2]+"</b><i>分</i>"),e(a).find(".secondDom").html("<b>"+s[3]+"</b><i>秒</i>")}}else e(a).find(".time").attr("data-time",""),e(a).find(".dayDom").html("<b>00</b><i>天</i>"),e(a).find(".hourDom").html("<b>00</b><i>时</i>"),e(a).find(".minuteDom").html("<b>00</b><i>分</i>"),e(a).find(".secondDom").html("<b>00</b><i>秒</i>")})},1e3)}})});