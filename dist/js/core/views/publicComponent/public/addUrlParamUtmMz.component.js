define(["underscore","jquery","backbone","../../../services/event.service"],function(t,e,r,n){return r.View.extend({initialize:function(t){var e=this;if(1!=/\=/g.test(t))return console.error("参数不合规范，应该是例如: utm=mz"),!1;var r=t.split("="),n=r[0],a=r[1];e.checkUrlParam(n,a),"mz"==e.getUrlParam(n)&&e.setLinkParam(t)},setLinkParam:function(t){e(document).ready(function(){e("a").each(function(r,n){var a=e(n).attr("href");void 0!=a&&0==/javascript:/g.test(a)&&0==/^#/g.test(a)&&(/\?/.test(a)?a+="&"+t:a+="?"+t,e(n).attr("href",a))}),e("[onclick]").each(function(r,n){if(/javascript:window/g.test(e(n).attr("onclick"))){var a=e(n).attr("onclick");a=a.match(/\'(.+?)\'/g)[0],/\?/.test(a)?a+="&"+t:a+="?"+t,e(n).attr("onclick","javascript:window.open("+a+', "_blank")')}})})},checkUrlParam:function(t,r){var n=this;n.getUrlParam(t)!=r&&navigator.userAgent.match(/(iPhone|iPod|Android|ios)/i)&&(window.location.href=n.getURL().replace(n.getHost(),e("#mobileSiteUrl").attr("href").replace("https://","").replace("http://","")))},getURL:function(){return window.location.href},getHost:function(){return window.location.host},getUrlParam:function(t){var e=new RegExp("(^|&)"+t+"=([^&]*)(&|$)"),r=window.location.search.substr(1).match(e);return null!=r?unescape(r[2]):null}})});